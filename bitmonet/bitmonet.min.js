(function($){var scripts=document.getElementsByTagName("script"),url=scripts[scripts.length-1].getAttribute("src"),bitmonet_url=url.substr(0,url.lastIndexOf("/")+1),head=document.getElementsByTagName("head")[0],css=[bitmonet_url+"bitmonet.css",bitmonet_url+"bitmonet_small.css"];for(var i in css){var link=document.createElement("link");link.setAttribute("href",css[i]);link.setAttribute("rel","stylesheet");link.setAttribute("type","text/css");if(i==1)link.setAttribute("media","(max-width: 420px)");head.appendChild(link)}function BitMonet(params){this.animatingTimerWidth=false;this.timer=null;this.checkModalTimer=null;this.invoiceCheckTimer=null;this.params=$.extend(true,{},{company:"The Washington Post",heading:"Continue Reading with a Bitcoin Pass",logo:false,subtitle:"You've read <span class='bitmonet-limit'>15</span> free articles - grab a Bitcoin pass to keep going!",useSubtitle:"Activate a pass to keep reading!",footerText:"Powered by Bitmonet.",footerLink:"/",footerLinkText:"Learn More",optionData:[{name:"Article Pass",description:"Read just this article",price:"10&cent;",value:10,note:"We hope you enjoy your article. Remember not to clear your cookies!","class":"articlePass"},{name:"Hour Pass",description:"1 hour of unlimited access",price:"$1",value:100,note:"Please remember not to clear your brower's cookies during this time.","class":"hourPass"},{name:"Day Pass",description:"All-you-can-read news, all day",price:"$3",value:300,note:"Please remember not to clear your brower's cookies during this time.","class":"dayPass"}],bitpayCreatePath:"http://bitmonet-rails.herokuapp.com/create_invoice",bitpayCheckPath:"http://bitmonet-rails.herokuapp.com/check_invoice",numberClickedNeedBuy:15,articleClickRefreshRate:7,homeLink:window.location.host},params);var saved=JSON.parse(this.getCookie("bitmonet-saved"));if(!saved)saved={};this.saved=$.extend({},{showThanks:false,articleTypeIndex:0,requireShowFromCheck:null,redirectPage:null,invoices:[],currentInvoice:null,successURL:null,articleUponClick:null},saved);this.bitmonetDomHTML='            <div id="bitmonet-grayOut"></div>            <div id="bitmonet-dialog">                <div class="bitmonet-relativeWrap">                    <div class="close EIEO"></div>                    <div class="bitmonet-content">                        <div class="bitmonet-header">                            <h4>'+this.params.company+"</h4>                            "+(this.params.logo?'<img src="'+this.params.logo+'" />':'<div class="bitmonet-logo"></div>')+'                            <p class="bitmonet-heading">'+this.params.heading+'</p>                            <p class="bitmonet-subtitle buyPass">                                '+this.params.subtitle+'                            </p>                        </div>                        <div class="bitmonet-purchaseOptions">                            <div class="bitmonet-purchaseOption articlePass EIEO">                                <div class="bitmonet-icon medium book"></div>                                <h5>'+this.params.optionData[0].name+'</h5>                                <p class="bitmonet-purchaseDesc">'+this.params.optionData[0].description+'</p>                                    <a class="bitmonet-buyLink" target="_blank">                                        <div class="bitmonet-button orange EIEO buyPass">                                            BUY FOR '+this.params.optionData[0].price+'                                        </div>                                    </a>                            </div>                            <div class="bitmonet-purchaseOption hourPass EIEO">                                <div class="bitmonet-icon medium clock"></div>                                <h5>'+this.params.optionData[1].name+'</h5>                                <p class="bitmonet-purchaseDesc">'+this.params.optionData[1].description+'</p>                                    <a class="bitmonet-buyLink" target="_blank">                                        <div class="bitmonet-button orange EIEO buyPass">                                            BUY FOR '+this.params.optionData[1].price+'                                        </div>                                    </a>                            </div>                            <div class="bitmonet-purchaseOption dayPass EIEO">                                <div class="bitmonet-icon medium happyFace"></div>                                <h5>'+this.params.optionData[2].name+'</h5>                                <p class="bitmonet-purchaseDesc">'+this.params.optionData[2].description+'</p>                                    <a class="bitmonet-buyLink" target="_blank">                                        <div class="bitmonet-button orange EIEO buyPass">                                            BUY FOR '+this.params.optionData[2].price+'                                        </div>                                    </a>                            </div>                            <div style="clear: both;"></div>                        </div>                    </div>                </div>                <div class="bitmonet-iframe">                    <div class="close EIEO"></div>                    <h4 class="bitmonet-passToBuy">                        Get Your <span class="bitmonet-passType">Article Pass</span>                    </h4>                    <iframe id="bitmonet-iframe" frameborder="0" border="0" src=""></iframe>                    <div class="bitmonet-expired">                        This transaction has expired. Would you like to                         <span class="bitmonet-reTryBitPay">try again?</span>                        <br /><br />                        <div class="bitmonet-cancelIframe EIEO">Go Back</div>                    </div>                    <div class="bitmonet-otherWindow">                        The payment is pending in another window.                         <br /><br />Please check back after you are done paying.                        <br /><br />                        <div class="bitmonet-cancelIframe EIEO">Go Back</div>                    </div>                    <div class="bitmonet-cancelIframe EIEO">Cancel</div>                </div>                <div class="bitmonet-thankYou">                    <div class="close EIEO"></div>                    <h4 class="bitmonet-thanksTitle">                        Thank you for purchasing a<span class="bitmonet-passType">n Article Pass</span>!                    </h4>                    <p>                        <span class="bitmonet-passNote">'+this.params.optionData[2].note+'</span>                         <br /> <br />                        If you have any questions, please call us at 1-800-477-4679.                    </p>                    <div class="bitmonet-thanksContinue EIEO">Continue</div>                </div>                <div class="bitmonet-footer">                '+this.params.footerText+' <a href="'+this.params.footerLink+'">'+this.params.footerLinkText+'</a>                </div>            </div>            <div id="bitmonet-timer" class="">                <div class="bitmonet-timerIcon EIEO"></div>                <div class="bitmonet-timerDescription">                    <div class="bitmonet-timerTime">                        <span class="bitmonet-hours bitmonet-timeNumber">0</span>                        <span class="bitmonet-timeSeparator">:</span>                        <span class="bitmonet-minutes bitmonet-timeNumber">00</span>                        <span class="bitmonet-timeSeparator">:</span>                        <span class="bitmonet-seconds bitmonet-timeNumber">00</span>                    </div>                    <div class="bitmonet-passType"></div>                </div>                <div class="bitmonet-timerToggle show EIEO">^</div>                <div style="clear: both;"></div>            </div>';this.articlesTracked=JSON.parse(this.getCookie("bitmonet-articlesTracked"));if(!this.articlesTracked)this.articlesTracked={};this.initialize()}BitMonet.prototype.initialize=function(){var self=this,$body=$("body");$body.append(this.bitmonetDomHTML);$("#bitmonet-grayOut").css("display","none");$("#bitmonet-dialog").css("display","none");$(".bitmonet-limit").text(this.params.numberClickedNeedBuy);$("#bitmonet-dialog .close").on("click",function(){self.saved.invoices=[];self.saved.currentInvoice=null;self.saveVars();self.checkThanksAndReverse();if(!self.saved.requireShowFromCheck){$("body").css({width:"inherit",height:"inherit",position:"inherit"});$("#bitmonet-grayOut").fadeOut();$("#bitmonet-dialog").fadeOut()}else{if(!self.articlesTracked[self.saved.redirectPage])self.saved.redirectPage=null;window.location=self.saved.redirectPage||self.params.homeLink}});$(document).keyup(function(e){if(e.which=="27")$("#bitmonet-dialog .close").trigger("click")});$(document).click(function(e){var dialogShowing=$("#bitmonet-dialog").is(":visible"),notDialog=$(e.target).attr("id")!="bitmonet-dialog",notChildOfDialog=$(e.target).parents("#bitmonet-dialog").length<=0;if(dialogShowing&&notDialog&&notChildOfDialog)$("#bitmonet-dialog .close").trigger("click")});$(window).resize(function(){self.check_body_padding_set_overlay();self.set_bmd_position()});$("#bitmonet-timer").on("mouseover",function(){if(!self.animatingTimerWidth&&!$(this).hasClass("timer-clicked")){$(this).stop().animate({bottom:"-1px"},"fast")}}).on("mouseout",function(){if(!self.animatingTimerWidth&&!$(this).hasClass("timer-clicked")){$(this).stop().animate({bottom:"-10px"},"fast")}});$("#bitmonet-timer").on("click",function(){if($(this).hasClass("timer-clicked")){$(this).find(".bitmonet-timerDescription").fadeOut("fast",function(){self.animatingTimerWidth=true;$("#bitmonet-timer").stop().animate({width:"60px",bottom:"-10px"},"normal",function(){self.animatingTimerWidth=false;$(this).find(".bitmonet-timerToggle").text("^")})});$(this).removeClass("timer-clicked")}else{self.animatingTimerWidth=true;$(this).animate({width:"132px",bottom:"-1px"},"normal",function(){$(this).find(".bitmonet-timerDescription").fadeIn();self.animatingTimerWidth=false;$(this).find(".bitmonet-timerToggle").text("x")});$(this).addClass("timer-clicked")}});$(".bitmonet-thankYou .bitmonet-thanksContinue").on("click",function(){if(!self.saved.requireShowFromCheck)$("#bitmonet-dialog .close").trigger("click");else{self.checkThanksAndReverse();return false}});$(".bitmonet-purchaseOption > .bitmonet-buyLink").on("click",function(){var passType=$(this).parent().find("h5").first().text();$(".bitmonet-iframe").find(".bitmonet-passType").text(passType);self.saved.articleTypeIndex=$(this).parent().index();var passClass=self.params.optionData[self.saved.articleTypeIndex].class;$(".bitmonet-iframe").find("h4").first().addClass(passClass);self.onm_window_parameters();if(windowWidth>500){self.createInvoice(self.params.optionData[self.saved.articleTypeIndex].value/100);return false}else self.createInvoice(self.params.optionData[self.saved.articleTypeIndex].value/100,true)});$(".bitmonet-cancelIframe").on("click",function(){$(".bitmonet-iframe:visible, .bitmonet-otherWindow:visible").fadeOut("normal",function(){$(".bitmonet-relativeWrap").show()})});$(".bitmonet-reTryBitPay").on("click",function(){if($(window).width()>500)self.createInvoice(self.params.optionData[self.saved.articleTypeIndex].value/100);else{var value=self.params.optionData[self.saved.articleTypeIndex].value/100;var link=$($(".bitmonet-buyLink")[self.saved.articleTypeIndex]);self.createInvoice(value,link,true)}});var path=window.location.pathname,successURL=this.saved.successURL||this.params.homeLink;$(window).on("unload",function(){self.saved.redirectPage=location.href;self.saveVars()});if(path.indexOf(successURL)!==-1){var query=unescape(window.location.search.split("?")[1]);var queryValueKey="&order[total_native][cents]";var foundIndex=query.indexOf(queryValueKey);if(foundIndex==-1)return;var valueIndex=foundIndex+queryValueKey.length+1;var endIndex=query.indexOf("&",valueIndex+queryValueKey.length+1);endIndex=endIndex===-1?query.length-1:endIndex;var queryValue=parseFloat(query.substring(valueIndex,endIndex));var passLink=this.saved.articleUponClick;this.setPass(queryValue,passLink)}for(var i in this.saved.invoices)this.checkInvoiceStatus(this.saved.invoices[i],true);if(this.saved.currentInvoice!=null){this.onm_window_parameters();if(windowWidth<500){$(".bitmonet-relativeWrap").hide();$("#bitmonet-iframe").hide();$(".bitmonet-iframe").fadeIn();$(".bitmonet-iframe > .bitmonet-cancelIframe").hide();$(".bitmonet-otherWindow").show();this.checkInvoiceStatus(this.saved.currentInvoice)}else this.checkInvoiceStatus(this.saved.currentInvoice,true);if(!$("#bitmonet-dialog").is(":visible")){this.show()}}this.saved.articleUponClick=path;var numTracked=Object.keys(this.articlesTracked).length,freeOver=numTracked>=this.params.numberClickedNeedBuy||this.params.numberClickedNeedBuy<1,hasPass=this.checkPassesAndSetTimer();if(!this.articlesTracked[path]&&numTracked<this.params.numberClickedNeedBuy){this.articlesTracked[path]=true;this.setCookie("bitmonet-articlesTracked",JSON.stringify(this.articlesTracked),365)}if(freeOver&&!hasPass&&!this.articlesTracked[path]){self.show();self.saved.requireShowFromCheck=true}else self.saved.requireShowFromCheck=false;if(this.saved.showThanks)this.showThankYouDom()};BitMonet.prototype.show=function(){this.check_body_padding_set_overlay();this.set_bmd_position();$("#bitmonet-grayOut").fadeIn();$("#bitmonet-dialog").fadeIn();$("body").css({width:"100%",height:"100%",position:"fixed"})};BitMonet.prototype.showThankYouDom=function(fade){if(fade&&$(".bitmonet-iframe").is(":visible")){$(".bitmonet-iframe").fadeOut("normal",function(){$(".bitmonet-thankYou").show()})}else if(fade){$(".bitmonet-relativeWrap").fadeOut("normal",function(){$(".bitmonet-thankYou").show()})}else{$(".bitmonet-relativeWrap").hide();$(".bitmonet-thankYou").show()}var articleTypeIndex=this.saved.articleTypeIndex,passType=this.params.optionData[articleTypeIndex].name;if(articleTypeIndex==0||articleTypeIndex==1)passType="n "+passType;else passType=" "+passType;$(".bitmonet-thankYou .bitmonet-passType").text(passType);$(".bitmonet-thankYou .bitmonet-passNote").text(this.params.optionData[articleTypeIndex].note);$(".bitmonet-thankYou h4").addClass(this.params.optionData[articleTypeIndex].class);this.show()};BitMonet.prototype.reverseThankYouDom=function(){$(".bitmonet-thankYou").fadeOut("normal",function(){$(".bitmonet-relativeWrap").fadeIn()})};BitMonet.prototype.checkThanksAndReverse=function(){if(this.saved.showThanks){this.reverseThankYouDom();this.saved.showThanks=false;this.saveVars()}};BitMonet.prototype.createInvoice=function(price,link,click){var source="";var self=this;$.ajax({type:"GET",url:self.params.bitpayCreatePath,data:{price:price,currency:"USD",redirectURL:location.href},dataType:"jsonp",success:function(result){if(typeof result!=="object"||!result.hasOwnProperty("id")){alert("An error occurred, please try again later.");return}self.saved.invoices.push(result.id);self.saved.currentInvoice=result.id;self.saveVars();if(link)window.location=result.url;else{source=result.url+"&view=iframe";$(".bitmonet-iframe").find("iframe").first().attr("src",source);$(".bitmonet-relativeWrap").hide();$(".bitmonet-expired").hide();$(".bitmonet-otherWindow").hide();$(".bitmonet-iframe").show();$("#bitmonet-iframe").show();$(".bitmonet-iframe .bitmonet-cancelIframe").show()}self.checkInvoiceStatus(result.id)},error:function(){alert("An error occurred, please try again later.")}})};BitMonet.prototype.onm_window_parameters=function(){windowWidth=$(window).width();windowHeight=$(window).height();documentWidth=$(document).width();documentHeight=$(document).height();vScrollPosition=$(document).scrollTop();hScrollPosition=$(document).scrollLeft()};BitMonet.prototype.set_bmd_position=function(){this.onm_window_parameters();var windowMobile=windowWidth<=420;if(windowMobile){$("#bitmonet-dialog").css("top","0px");$("#bitmonet-dialog").css("left","0px");return}var bmHeight=478;var bmWidth=700;if($("#bitmonet-dialog").is(":visible")){bmHeight=$("#bitmonet-dialog").outerHeight();bmWidth=$("#bitmonet-dialog").outerWidth()}var bmTop=windowHeight/2-bmHeight/2;bmTop=bmTop<0?0:bmTop;var bmLeft=windowWidth/2-bmWidth/2;bmLeft=bmLeft<0?0:bmLeft;$("#bitmonet-dialog").css("top",bmTop+"px");$("#bitmonet-dialog").css("left",bmLeft+"px")};BitMonet.prototype.check_body_padding_set_overlay=function(){this.onm_window_parameters();var windowMobile=windowWidth<=420;if(windowMobile)return;var top=this.get_number_from_px($("body").css("margin-top"));var bottom=this.get_number_from_px($("body").css("margin-bottom"));var left=this.get_number_from_px($("body").css("margin-left"));var right=this.get_number_from_px($("body").css("margin-right"));$("#bitmonet-grayOut").css("top","-"+top+"px");$("#bitmonet-grayOut").css("left","-"+left+"px");$("#bitmonet-grayOut").css("width",$(document).width()+right+"px");$("#bitmonet-grayOut").css("height",$(document).height()+bottom+"px")};BitMonet.prototype.get_number_from_px=function(string){var index=string.indexOf("px");return parseInt(string.substring(0,index))};BitMonet.prototype.setCookie=function(c_name,value,exdays){var exdate=new Date;exdate.setDate(exdate.getDate()+exdays);var c_value=escape(value)+(exdays==null?"":"; expires="+exdate.toUTCString());var host=window.location.host;if(host.indexOf("www.")!=-1){host=host.substring(3)}else if(host[0]!="."){host="."+host}var domain=";domain="+host+";path=/";document.cookie=c_name+"="+c_value+domain};BitMonet.prototype.getCookie=function(c_name){var c_value=document.cookie;var c_start=c_value.indexOf(" "+c_name+"=");if(c_start==-1){c_start=c_value.indexOf(c_name+"=")}if(c_start==-1){c_value=null}else{c_start=c_value.indexOf("=",c_start)+1;var c_end=c_value.indexOf(";",c_start);if(c_end==-1){c_end=c_value.length}c_value=unescape(c_value.substring(c_start,c_end))}return c_value};BitMonet.prototype.checkPassesAndSetTimer=function(){var href=window.location.href;var dayPasses=JSON.parse(this.getCookie("bitmonet-dayPasses"));var foundActiveDayPass=false;var firstDayPassLocation=-1;var deletedPasses=[];for(var dayPass in dayPasses){var pass=dayPasses[dayPass];if(pass.activated){var hourDiff=(new Date-new Date(pass.start))/1e3/60/60;if(hourDiff>=24){deletedPasses.push(dayPass)}else if(!foundActiveDayPass){foundActiveDayPass=true;var expiry=new Date(pass.start);expiry.setHours(expiry.getHours()+24);this.setTimer(expiry);return true}else if(foundActiveDayPass){dayPasses[dayPass].activated=false}}else if(firstDayPassLocation==-1){firstDayPassLocation=dayPass}}for(var i=deletedPasses.length-1;i>=0;i--){if(deletedPasses[i]<firstDayPassLocation){firstDayPassLocation--}dayPasses.splice(deletedPasses[i],1)}if(dayPasses)this.setCookie("bitmonet-dayPasses",JSON.stringify(dayPasses),365);var hourPasses=JSON.parse(this.getCookie("bitmonet-hourPasses"));var foundActiveHourPass=false;var firstHourPassLocation=-1;deletedPasses=[];for(var hourPass in hourPasses){var pass=hourPasses[hourPass];if(pass.activated){var hourDiff=(new Date-new Date(pass.start))/1e3/60/60;if(hourDiff>=1){deletedPasses.push(hourPass)}else if(!foundActiveHourPass&&!foundActiveDayPass){foundActiveHourPass=true;var expiry=new Date(pass.start);expiry.setHours(expiry.getHours()+1);this.setTimer(expiry);return true}else if(foundActiveHourPass){hourPasses[hourPass].activated=false}}else if(firstHourPassLocation==-1){firstHourPassLocation=hourPass}}for(var i=deletedPasses.length-1;i>=0;i--){if(deletedPasses[i]<firstHourPassLocation)firstHourPassLocation--;hourPasses.splice(deletedPasses[i],1)}if(hourPasses)this.setCookie("bitmonet-hourPasses",JSON.stringify(hourPasses),365);var articlePasses=JSON.parse(this.getCookie("bitmonet-articlePasses"));var foundActiveArticlePass=false;var firstArticlePassLocation=-1;for(var articlePass in articlePasses){var pass=articlePasses[articlePass];if(href.indexOf(pass.link)!=-1){if(!pass.activated)pass.activated=true;this.setCookie("bitmonet-articlePasses",JSON.stringify(articlePasses),365);foundActiveArticlePass=true;return true}else if((!pass.activated||!pass.link)&&firstArticlePassLocation==-1)firstArticlePassLocation=articlePass}if(!foundActiveDayPass&&!foundActiveHourPass&&!foundActiveArticlePass){if(firstDayPassLocation!=-1){dayPasses[firstDayPassLocation].start=new Date;dayPasses[firstDayPassLocation].activated=true;foundActiveDayPass=true;var expiry=new Date(dayPasses[firstDayPassLocation].start);expiry.setHours(expiry.getHours()+24);this.setTimer(expiry);this.setCookie("bitmonet-dayPasses",JSON.stringify(dayPasses),365);return true}else if(firstHourPassLocation!=-1){hourPasses[firstHourPassLocation].start=new Date;hourPasses[firstHourPassLocation].activated=true;foundActiveHourPass=true;var expiry=new Date(hourPasses[firstHourPassLocation].start);expiry.setHours(expiry.getHours()+1);this.setTimer(expiry);this.setCookie("bitmonet-hourPasses",JSON.stringify(hourPasses),365);return true}else if(firstArticlePassLocation!=-1){if(!this.saved.articleUponClick){alert("wtf?");debugger}articlePasses[firstArticlePassLocation].link=this.saved.articleUponClick;articlePasses[firstArticlePassLocation].activated=true;foundActiveArticlePass=true;this.setCookie("bitmonet-articlePasses",JSON.stringify(articlePasses),365);return true}else return false}return foundActiveDayPass||foundActiveHourPass||foundActiveArticlePass};BitMonet.prototype.setPass=function(passPrice,passLink){if(passPrice==this.params.optionData[0].value){var articlePasses=JSON.parse(this.getCookie("bitmonet-articlePasses"))||[];var newPass={link:null,activated:false};articlePasses.push(newPass);this.setCookie("bitmonet-articlePasses",JSON.stringify(articlePasses),365);this.saved.showThanks=true;this.saved.articleTypeIndex=0;this.saveVars();if(passLink!==undefined)window.location=passLink||bitmonet.homeLink}else if(passPrice==this.params.optionData[1].value){var hourPasses=JSON.parse(this.getCookie("bitmonet-hourPasses"))||[];var newPass={start:new Date,activated:false};hourPasses.push(newPass);this.setCookie("bitmonet-hourPasses",JSON.stringify(hourPasses),365);this.saved.showThanks=true;this.saved.articleTypeIndex=1;this.saveVars();if(passLink!==undefined)window.location=passLink||this.params.homeLink}else if(passPrice==this.params.optionData[2].value){var dayPasses=JSON.parse(this.getCookie("bitmonet-dayPasses"))||[];var newPass={start:new Date,activated:false};dayPasses.push(newPass);this.setCookie("bitmonet-dayPasses",JSON.stringify(dayPasses),365);this.saved.showThanks=true;this.saved.articleTypeIndex=2;this.saveVars();if(passLink!==undefined)window.location=passLink||this.params.homeLink}else alert("something went wrong! This pass doesn't exist")};BitMonet.prototype.setTimer=function(timeLeft){clearTimeout(this.timer);var diff=timeLeft-new Date,self=this,hours=0,minutes=0,seconds=0;if(diff>=0){var hours=Math.floor(diff/1e3/60/60);diff-=hours*1e3*60*60;var minutes=Math.floor(diff/1e3/60);diff-=minutes*1e3*60;var seconds=Math.floor(diff/1e3);diff-=seconds*1e3}hours=hours<10?"0"+hours:hours;$("#bitmonet-timer .bitmonet-hours").text(hours);minutes=minutes<10?"0"+minutes:minutes;$("#bitmonet-timer .bitmonet-minutes").text(minutes);seconds=seconds<10?"0"+seconds:seconds;$("#bitmonet-timer .bitmonet-seconds").text(seconds);if(!$("#bitmonet-timer").hasClass("timer-visible")){$("#bitmonet-timer").addClass("timer-visible");$("#bitmonet-timer").stop().animate({bottom:"-5px"})}if((timeLeft-new Date)/1e3>1){this.timer=setTimeout(function(){self.setTimer(timeLeft)},1e3)}else{if($("#bitmonet-timer").hasClass("timer-visible")){$("#bitmonet-timer").removeClass("timer-visible");$("#bitmonet-timer").stop().animate({bottom:"-62px"})}clearTimeout(this.timer);var numTracked=Object.keys(this.articlesTracked).length,freeOver=numTracked>this.params.numberClickedNeedBuy||this.params.numberClickedNeedBuy<1,hasPass=this.checkPassesAndSetTimer();if(freeOver&&!hasPass){this.show();this.saved.requireShowFromCheck=true}else this.saved.requireShowFromCheck=false}};BitMonet.prototype.checkInvoiceStatus=function(id,nocall){clearTimeout(this.invoiceCheckTimer);var self=this;$.ajax({type:"GET",url:this.params.bitpayCheckPath,data:{id:id},dataType:"jsonp",error:function(){self.invoiceCheckTimer=setTimeout(function(){self.checkInvoiceStatus(id)},1e3)},success:function(result){if(typeof result!=="object"||!result.hasOwnProperty("id")){self.invoiceCheckTimer=setTimeout(function(){self.checkInvoiceStatus(id)},1e3);return}if(nocall==undefined&&result.status=="new"){self.invoiceCheckTimer=setTimeout(function(){self.checkInvoiceStatus(result.id)},1e3)}else if(nocall==undefined&&result.status=="expired"||result.status=="invalid"){$("#bitmonet-iframe:visible, .bitmonet-cancelIframe:visible, .bitmonet-otherWindow:visible").fadeOut("normal",function(){$(".bitmonet-expired").fadeIn();if(self.saved.currentInvoice!=null){self.saved.currentInvoice=null;self.saveVars()}})}else if(result.status=="paid"||result.status=="confirmed"||result.status=="complete"){if(jQuery.inArray(result.id,self.saved.invoices)!=-1){self.saved.invoices.splice(jQuery.inArray(result.id,self.saved.invoices),1);self.saveVars()}if(self.saved.currentInvoice!=null){self.saved.currentInvoice=null;self.saveVars()}self.setPass(result.price*100);self.checkPassesAndSetTimer();self.saved.requireShowFromCheck=false;if(!$("#bitmonet-dialog").is(":visible")){self.show()}self.showThankYouDom(true)}else if(nocall){source=result.url+"&view=iframe";$(".bitmonet-iframe").find("iframe").first().attr("src",source);$(".bitmonet-relativeWrap").hide();$(".bitmonet-expired").hide();$(".bitmonet-otherWindow").hide();$(".bitmonet-iframe").show();$("#bitmonet-iframe").show();$(".bitmonet-iframe .bitmonet-cancelIframe").show();var passType=self.params.optionData[self.saved.articleTypeIndex].name;$(".bitmonet-iframe").find(".bitmonet-passType").text(passType);var passClass=self.params.optionData[self.saved.articleTypeIndex].class;$(".bitmonet-iframe").find("h4").first().addClass(passClass);if(!$("#bitmonet-dialog").is(":visible")){self.show()}}}})};BitMonet.prototype.saveVars=function(){this.setCookie("bitmonet-saved",JSON.stringify(this.saved),30)};$.extend({BitMonet:function(params){return new BitMonet(params)}})})(jQuery);